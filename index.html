<!DOCTYPE html>
<html lang="en">

<head>
  <meta content="text/html" http-equiv="content-type">
  <meta charset="utf-8">
  <title>Mini Padder</title>
  <link rel="icon" type="image/x-icon" href="./favicon.ico">
  <meta name="theme-color" content="#65849f">
  
  <meta property="og:title" content="Mini Padder">
  <meta property="og:site_name" content="GitHub">
  <meta name="twitter:site"     content="@github">
  <meta name="author"          content="Dinir Nertan">
  <meta name="twitter:creator" content="@DinirNertan">
  <meta name="description"        content="A simple and clear input overlay for your gamepads and joysticks. Show your moves in your stream and videos.">
  <meta property="og:description" content="A simple and clear input overlay for your gamepads and joysticks. Show your moves in your stream and videos.">
  <link rel="canonical"      href="https://dinir.github.io/mini-padder/">
  <meta property="og:url" content="https://dinir.github.io/mini-padder/">
  <meta property="og:image" content="https://dinir.github.io/mini-padder/image/open-graph-image.png">
  <meta property="og:image:type" content="image/png">
  <meta property="og:image:width"  content="1280">
  <meta property="og:image:height" content="640">
  <meta property="og:image:alt" content="An overlay of four gamepads. They resemble DInput, 8-button Joystick, XInput, 6-button gamepad. D-pad or stick is pushed up and right, and two buttons of following are pressed: first face button and R1 for DInput and XInput, first and last face buttons for Joystick, B and C for 6-button gamepad.">
  <meta property="og:type" content="website">
  <meta name="twitter:card" content="summary_large_image">
  
  <meta name="viewport" content="width=1048">
  <meta name="google-site-verification" content="Giwp1vVm5mdTEbNFZEphTPtCn2VKV85F2LIDoSrCsCk">
  
  <link rel="stylesheet" href="./css/main.css">
  <link rel="stylesheet" href="./css/canvasContainer.css">
  <link rel="stylesheet" href="./css/controlPanel.css">
  <link rel="stylesheet" href="./css/OnBrowserTextEditor.css">
  
  <script src="./js/module/ErrorLogCollector.js"></script>
  <script src="./js/module/GamepadWatcher.js"></script>
  <script src="./js/module/MappingManager.js"></script>
  <script src="./js/module/GamepadRenderer.js"></script>
  <script src="./js/module/OnBrowserTextEditor.js"></script>
  <script src="./js/module/Updater.js"></script>
  <script src="./js/interface/Mapper.js"></script>
  <script src="./js/interface/controlPanel.js"></script>
  <script src="./js/interface/MiniPadderUpdater.js"></script>
</head>


<body>
<div id="canvas-container">
  <div>
  </div>
  <div>
  </div>
  <div>
  </div>
  <div>
  </div>
</div>

<div id="control-panel" class="control-panel" data-nosnippet>
  <div class="option" data-name="assignment">
    <b>Input Assignment</b>
    <div class="after-margin">
      <button class="inactive">Gamepad Name</button>
      <button class="inactive">Gamepad Name</button>
      <button class="inactive">Gamepad Name</button>
      <button class="inactive">Gamepad Name</button>
    </div>
    <span class="description">
      Make an input after pressing the button to start assigning.<br>
      Click the button again anytime to abort assigning.
    </span>
  </div>
  <div class="option" data-name="layout">
    <b>Gamepad Layout</b>
    <label class="full-width inactive">
      <span>Gamepad Name</span> is
      <select></select><br>
    </label>
    <label class="full-width inactive">
      <span>Gamepad Name</span> is
      <select></select><br>
    </label>
    <label class="full-width inactive">
      <span>Gamepad Name</span> is
      <select></select><br>
    </label>
    <label class="full-width inactive">
      <span>Gamepad Name</span> is
      <select></select>
    </label>
  </div>
  <div class="option half-width no-divider va-top" data-name="displayWidth">
    <label for="display-width-input"><b>Display Width</b></label>
    <div style="width: 10em;">
      <datalist class="hashmark" id="display-width-options">
        <option value="1" label="1"></option>
        <option value="2" label="2"></option>
        <option value="3" label="4"></option>
      </datalist>
      <input class="allGamepad with-hashmark" id="display-width-input" type="range" list="display-width-options" min="1" max="3" step="1">
    </div>
    <span class="description">
      <b>Display Size</b><br>
      <span>&nbsp;256x144</span> (one gamepad)<br>
      <span id="displaySizeDescriptor"></span> (all gamepads)
    </span>
  </div>
  <div class="option half-width no-divider" data-name="fade">
    <b>Fade-out</b>
    <label>
      <span>Time: </span>
      <input type="text" placeholder="8,16,32">
    </label>
    <span class="description">seconds for each fade-out level</span><br>
    <label>
      <span>Opacity: </span>
      <input type="text" placeholder="0.5,0.1,0">
    </label>
    <span class="description">transparency values for each level</span><br>
    <label>
      <span>Duration: </span>
      <input type="text" placeholder="4">
    </label>
    <span class="description">transition time of fade-out effect</span>
  </div>
  <div class="option top-divider" data-name="management">
    <b>Export & Import</b>
    <div class="after-margin">
      <button data-name="mappings">Gamepad Mappings</button>
      <button data-name="skinList">Skin List</button>
      <button data-name="controlPanel">Control Panel Settings</button>
      <button data-name="errorLog">Error Log</button>
    </div>
    <span class="description">
      You can copy JSON of the data to save in a text file,
      or paste from such text file and
      store them in the local storage of this web page.
    </span>
  </div>
  <div class="option" data-name="custom-skin">
    <label id="customSkinLoadArea">
      <b>Import Custom Skin</b>
      <span class="after-margin file-input-container">
        <input class="visually-hidden"
               type="file" accept="application/json,image/*" multiple>
        <button data-name="fileSelect">Choose Files</button>
        <span class="inactive">
          Currently Loaded:
          <span id="currentlyLoadedCustomSkin">Nothing</span>
        </span>
      </span>
      <span class="description">
        Upload a json and up to 4 images for the custom skin.
        New files replace old ones.
        Click anywhere in this area to bring the file select screen.
      </span>
    </label>
  </div>
  <div>
    <div>
      <b class="inline">Mini Padder</b><sub> <span class="version"></span></sub>
      &copy; 2020 Dinir Nertan
    </div>
    <address>
      <span class="link-list">
        <a class="head"
           href="https://github.com/Dinir/mini-padder" target="_blank"
        >Repository</a>
        <a href="https://github.com/Dinir/mini-padder/wiki" target="_blank"
        >Wiki</a>
        <a href="https://github.com/Dinir/mini-padder/issues" target="_blank"
        >Support</a>
      </span>
      <span class="align-right">
        <a href="https://ko-fi.com/dinir" target="_blank">Donate</a>
      </span>
    </address>
  </div>
</div>

<!-- dom references -->
<script>
  const canvasContainer = document.getElementById('canvas-container')
  const canvas = Array.from(canvasContainer.querySelectorAll('div'))
  const cpDom = document.getElementById('control-panel')
  const cpDomSizeDescriptor = document.getElementById('displaySizeDescriptor')
  const cpDomSkinUploader = {
    droparea: cpDom.querySelector('#customSkinLoadArea'),
    input: cpDom.querySelector('#customSkinLoadArea input'),
    button: cpDom.querySelector('#customSkinLoadArea button[data-name="fileSelect"]'),
    indicator: document.getElementById('currentlyLoadedCustomSkin')
  }
</script>

<!-- store error logs -->
<script>
  const Logger = new ErrorLogCollector()
  // get gamepad viewer messages on console
  window.addEventListener('GPVMessage', e => {
    if (e.detail.type === 'error') {
      console.error(e.detail.from + ':', e.detail.message)
      if (
        e.detail.message &&
        e.detail.message instanceof Error
      ) {
        window.dispatchEvent(new CustomEvent('customErrorMessage', {
          detail: e.detail.message
        }))
      }
    } else {
      console.log(e.detail.from + ':', e.detail.message)
    }
  })
</script>

<!-- class instances -->
<script>
  const Watcher = new GamepadWatcher()
  const Mapper = new MappingInterface()
  const Renderer = new GamepadRenderer(canvas)
  const Obte = new OnBrowserTextEditor()
  Obte.dom.wrapper.classList.add('control-panel')
  Obte.appendToParent(document.body)
</script>

<!-- control panel -->
<script>
  const Cp = new ControlPanel({
    assignment: 'dynamicButtons',
    layout: 'selectFromList',
    displayWidth: 'slider',
    fadeout: 'textArray',
    management: 'buttons',
    customSkin: 'uploader'
  }, [
    'gamepadconnected', 'gamepaddisconnected'
  ])
  cpPanel = Cp.panel
  
  if (Cp.browser !== 'Chrome') {
    const alertDiv = document.createElement('div')
    alertDiv.classList.add('vertical-space-but-no-divider', 'caution')
    alertDiv.innerHTML =
      'The page is running on a browser that isn\'t Chromium-based. ' +
      'Even if features work, the overlay may suffer a low framerate.'
    cpDom.insertBefore(alertDiv, cpDom.firstElementChild)
  }
  
  cpPanel.assignment.assign(
    cpDom.querySelector('div[data-name="assignment"]'),
    Mapper.startAssignment
  )
  
  cpPanel.layout.assign(
    cpDom.querySelector('div[data-name="layout"]'),
    cpDom.querySelectorAll('div[data-name="layout"] label span'),
    Renderer.skinList,
    Renderer.changeSkinOfSlot,
    Renderer.skinMapping
  )

  cpPanel.displayWidth.assign(
    cpDom.querySelector('div[data-name="displayWidth"] input'), e => {
      canvasContainer.dataset.width = e.target.value
      cpDomSizeDescriptor.innerHTML =
        (canvasContainer.offsetWidth < 1000 ? '&nbsp;' : '') +
        canvasContainer.offsetWidth +
        'Ã—' + canvasContainer.offsetHeight
    }
  )
  
  cpPanel.fadeout.assign(
    cpDom.querySelector('div[data-name="fade"]'),
    Renderer.setFadeoutOptionFromTextArray
  )
  if (!cpPanel.fadeout.panelValue) {
    cpPanel.fadeout.receivePanelValue(
      Renderer.getFadeoutOptionAsTextArray()
    )
    cpPanel.fadeout.updatePanelValue(
      cpPanel.fadeout.panelValue
    )
  }

  cpPanel.management.assign(
    cpDom.querySelector('div[data-name="management"]'), e => {
      switch (e.target.dataset.name) {
        case 'mappings':
          Obte.changeFocus(
            'Gamepad Mappings',
            Mapper.mappings,
            Mapper.import
          )
          break
        case 'skinList':
          Obte.changeFocus(
            'Skin List',
            Renderer.skinList,
            Renderer.reloadSkins
          )
          break
        case 'controlPanel':
          Obte.changeFocus(
            'Control Panel Configuration',
            Cp.panelValues,
            Cp.setPanelValuesInBulk
          )
          break
        case 'errorLog':
          Obte.changeFocus(
            'Error Log',
            Logger.errorLog,
            null,
            true
          )
          break
      }
    }
  )
  
  cpPanel.customSkin.assign(
    cpDomSkinUploader.input,
    cpDomSkinUploader.droparea,
    cpDomSkinUploader.button,
    f => true,
    cpDomSkinUploader.indicator
  )
</script>

<!-- updater -->
<script>
  const version = '3.0.1'
  const MPUpdater = new MiniPadderUpdater(version)
  const versionDoms = document.getElementsByClassName('version')
  Array.from(versionDoms).forEach(v => v.innerHTML = version)
</script>

</body>

</html>
